const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebPreviewModal-B8S2bN4U.js","assets/index-9AhgM91U.js","assets/index-BAzET-b6.css","assets/Silk-BXyBIzFR.js"])))=>i.map(i=>d[i]);
import{R as x,j as e,_ as I}from"./index-9AhgM91U.js";import{b as U}from"./banner-DoJb6kMf.js";const z="#f43f5e";function F({imageSrc:r,steps:N,onCreateRegion:P}){const f=x.useRef(null),w=x.useRef(null),m=x.useRef({w:0,h:0}),[p,k]=x.useState({w:0,h:0}),u=x.useRef(null),[d,j]=x.useState(null),y=x.useCallback(()=>{const s=f.current;if(!s||!m.current.w||!m.current.h)return;const i=s.clientWidth,o=m.current.h/m.current.w,b=Math.min(Math.round(window.innerHeight*.7),900);let v=i,t=Math.round(v*o);t>b&&(t=b,v=Math.round(t/o)),k({w:v,h:t})},[]);function S(s){const i=s.currentTarget;m.current={w:i.naturalWidth,h:i.naturalHeight},y()}x.useLayoutEffect(()=>{const s=new ResizeObserver(y);f.current&&s.observe(f.current);const i=()=>y();return window.addEventListener("resize",i),()=>{s.disconnect(),window.removeEventListener("resize",i)}},[y]);function R(s,i){const o=w.current.getBoundingClientRect(),b=(s-o.left)/o.width,v=(i-o.top)/o.height;return{x:A(b),y:A(v)}}function l(s){var o,b;if(!r)return;(b=(o=s.currentTarget).setPointerCapture)==null||b.call(o,s.pointerId);const i=R(s.clientX,s.clientY);u.current=i,j({xPct:i.x,yPct:i.y,wPct:0,hPct:0})}function E(s){if(!u.current)return;const i=u.current,o=R(s.clientX,s.clientY),b=Math.min(i.x,o.x),v=Math.min(i.y,o.y),t=Math.abs(i.x-o.x),n=Math.abs(i.y-o.y);j({xPct:b,yPct:v,wPct:t,hPct:n})}function D(s){var t,n;if(!u.current)return;try{(n=(t=s.currentTarget).releasePointerCapture)==null||n.call(t,s.pointerId)}catch{}const i=u.current,o=d?{x:d.xPct+d.wPct,y:d.yPct+d.hPct}:i;if(u.current=null,!d)return j(null);const b=Math.abs(i.x-o.x),v=Math.abs(i.y-o.y);b>=.01&&v>=.01&&P({...d}),j(null)}return r?e.jsxs("div",{className:"card rounded-2xl p-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Canvas (60%) — kéo chuột để khoanh, auto đánh số"}),e.jsxs("div",{ref:f,className:"relative w-full border border-white/10 rounded-xl overflow-hidden",children:[e.jsx("img",{ref:w,src:r,onLoad:S,className:"block select-none",style:{width:p.w||"100%",height:p.h||"auto"}}),e.jsxs("svg",{className:"absolute inset-0",style:{cursor:"crosshair"},width:p.w||0,height:p.h||0,onPointerDown:l,onPointerMove:E,onPointerUp:D,onPointerLeave:D,children:[d&&e.jsx("rect",{x:`${d.xPct*100}%`,y:`${d.yPct*100}%`,width:`${d.wPct*100}%`,height:`${d.hPct*100}%`,rx:8,ry:8,fill:z,fillOpacity:.12,stroke:z,strokeWidth:3,strokeDasharray:"8 6"}),N.map(s=>{const i=s.region.xPct*(p.w||1),o=s.region.yPct*(p.h||1),b=s.region.wPct*(p.w||1),v=s.region.hPct*(p.h||1);return e.jsxs("g",{children:[e.jsx("rect",{x:i,y:o,width:b,height:v,rx:8,ry:8,fill:"none",stroke:z,strokeWidth:3}),e.jsxs("g",{transform:`translate(${i+6}, ${o+6})`,children:[e.jsx("circle",{r:14,fill:"white",stroke:z,strokeWidth:3}),e.jsx("text",{x:0,y:5,fontSize:14,textAnchor:"middle",fontWeight:700,fill:z,children:s.index})]})]},s.id)})]})]})]}):e.jsx("div",{className:"card rounded-2xl p-6 h-[420px] grid place-items-center text-zinc-400",children:"Upload ảnh giai đoạn để khoanh"})}function A(r){return Math.min(1,Math.max(0,r))}function O({steps:r,onThumbChange:N,onTitleChange:P,onDescChange:f,onMove:w,onDelete:m}){return e.jsxs("div",{className:"card rounded-2xl p-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Steps (40%) — ảnh vuông + tiêu đề + mô tả"}),r.length===0&&e.jsx("div",{className:"opacity-70 text-sm",children:"Khoanh bên trái để tạo step…"}),e.jsx("div",{className:"space-y-3 max-h-[640px] overflow-auto pr-1",children:r.map(p=>e.jsx(X,{step:p,onThumbChange:N,onTitleChange:P,onDescChange:f,onMove:w,onDelete:m},p.id))})]})}function X({step:r,onThumbChange:N,onTitleChange:P,onDescChange:f,onMove:w,onDelete:m}){async function p(u){var y;const d=(y=u.target.files)==null?void 0:y[0];if(!d)return;const j=await $(d);N(r.id,j)}async function k(u){var j,y;const d=(j=u.clipboardData)==null?void 0:j.items;if(d){for(const S of d)if((y=S.type)!=null&&y.startsWith("image/")){const R=S.getAsFile();if(R){const l=await $(R);N(r.id,l),u.preventDefault();return}}}}return e.jsx("div",{className:"p-3 rounded-xl border border-white/10 bg-white/[0.03] hover:bg-white/[0.06] transition",onPaste:k,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("label",{className:"block cursor-pointer",children:[e.jsx("div",{className:"w-24 h-24 rounded-lg bg-white/5 border border-white/10 grid place-items-center overflow-hidden",children:r.thumbSrc?e.jsx("img",{src:r.thumbSrc,className:"w-24 h-24 object-cover"}):e.jsxs("span",{className:"text-[11px] text-white/70 text-center px-2",children:["Click để thêm ảnh",e.jsx("br",{}),"hoặc Ctrl+V"]})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:p})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("input",{value:r.title,onChange:u=>P(r.id,u.target.value),className:"w-full bg-zinc-900 border border-white/10 rounded px-2 py-1 text-sm font-semibold"}),e.jsx("textarea",{value:r.desc,onChange:u=>f(r.id,u.target.value),placeholder:"Mô tả chi tiết…",className:"mt-2 w-full bg-zinc-900 border border-white/10 rounded px-2 py-2 text-sm h-20"}),e.jsxs("div",{className:"mt-2 text-xs opacity-75",children:["Vùng: x=",W(r.region.xPct)," y=",W(r.region.yPct)," w=",W(r.region.wPct)," h=",W(r.region.hPct)]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{className:"text-xs px-2 py-1 rounded bg-zinc-800 hover:bg-zinc-700",onClick:()=>w(r.id,"up"),children:"Up"}),e.jsx("button",{className:"text-xs px-2 py-1 rounded bg-zinc-800 hover:bg-zinc-700",onClick:()=>w(r.id,"down"),children:"Down"}),e.jsx("button",{className:"text-xs px-2 py-1 rounded bg-red-600 hover:bg-red-500 mt-auto",onClick:()=>m(r.id),children:"Xóa"})]})]})})}function W(r){return Math.round(r*100)+"%"}function $(r){return new Promise((N,P)=>{const f=new FileReader;f.onload=()=>N(String(f.result)),f.onerror=P,f.readAsDataURL(r)})}const V=x.lazy(()=>I(()=>import("./WebPreviewModal-B8S2bN4U.js"),__vite__mapDeps([0,1,2,3]))),T=[{key:"A4_L",label:"A4 ngang (1754×1240)",width:1754,height:1240},{key:"HD_16_9",label:"16:9 (1920×1080)",width:1920,height:1080}];function B(){return Math.random().toString(36).slice(2)}const G="HƯỚNG DẪN SỬ DỤNG (WEB)";function q(){const[r,N]=x.useState(G),[P,f]=x.useState(U),[w,m]=x.useState([]),[p,k]=x.useState(void 0),[u,d]=x.useState(!1),[j,y]=x.useState(8),[S,R]=x.useState(T[0]),l=w.find(t=>t.id===p);function E(t){var c;const n=(c=t.target.files)==null?void 0:c[0];if(!n)return;const a=new FileReader;a.onload=()=>f(String(a.result)),a.readAsDataURL(n)}function D(t){const n=t.target.files;if(!n||!n.length)return;const a=[];for(const c of Array.from(n))a.push(new Promise(h=>{const g=new FileReader;g.onload=()=>{const C=String(g.result),M=new Image;M.onload=()=>{h({id:B(),name:c.name.replace(/\.[^.]+$/,""),imageSrc:C,natW:M.naturalWidth,natH:M.naturalHeight,steps:[]})},M.src=C},g.readAsDataURL(c)}));Promise.all(a).then(c=>{m(h=>{const g=[...h,...c];return!h.length&&g.length&&k(g[0].id),g}),t.target.value=""})}function s(t){m(n=>n.filter(a=>a.id!==t)),k(n=>{var a;return n===t?(a=w.filter(h=>h.id!==t)[0])==null?void 0:a.id:n})}function i(t){l&&m(n=>n.map(a=>{if(a.id!==l.id)return a;const c=a.steps.length+1,h={id:B(),index:c,region:t,title:`Bước ${c}`,desc:""};return{...a,steps:[...a.steps,h]}}))}function o(t,n){l&&m(a=>a.map(c=>c.id!==l.id?c:{...c,steps:c.steps.map(h=>h.id===t?{...h,...n}:h)}))}function b(t){l&&m(n=>n.map(a=>{if(a.id!==l.id)return a;const h=a.steps.filter(g=>g.id!==t).map((g,C)=>({...g,index:C+1,title:g.title.replace(/^Bước\s+\d+/,`Bước ${C+1}`)}));return{...a,steps:h}}))}function v(t,n){l&&m(a=>a.map(c=>{if(c.id!==l.id)return c;const h=c.steps.findIndex(L=>L.id===t);if(h<0)return c;const g=n==="up"?h-1:h+1;if(g<0||g>=c.steps.length)return c;const C=c.steps.slice(),[M]=C.splice(h,1);C.splice(g,0,M);const H=C.map((L,_)=>({...L,index:_+1,title:L.title.replace(/^Bước\s+\d+/,`Bước ${_+1}`)}));return{...c,steps:H}}))}return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-white/10 bg-zinc-950/70 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-3 flex items-center gap-3",children:[e.jsx("div",{className:"text-lg font-bold",children:"Manual Builder — WEB"}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsxs("label",{className:"text-sm opacity-80",children:["Khổ trang",e.jsx("select",{className:"ml-2 bg-zinc-900 border border-white/10 rounded px-2 py-1",value:S.key,onChange:t=>R(T.find(n=>n.key===t.target.value)),children:T.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key))})]}),e.jsxs("label",{className:"text-sm opacity-80",children:["Tối đa step/trang",e.jsx("select",{className:"ml-2 bg-zinc-900 border border-white/10 rounded px-2 py-1",value:j,onChange:t=>y(Number(t.target.value)),children:[6,8,10,12].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx("button",{onClick:()=>d(!0),className:"px-3 py-1 rounded bg-brand-600 hover:bg-brand-500",disabled:!w.length,children:"Preview / Export"})]})]})}),e.jsxs("div",{className:"mx-auto max-w-7xl p-4 grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12 card rounded-2xl p-4 flex flex-wrap items-center gap-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Header"}),e.jsx("img",{src:P,className:"h-16 w-[280px] object-cover rounded-lg border border-white/10"}),e.jsx("input",{type:"file",accept:"image/*",onChange:E}),e.jsxs("div",{className:"ml-auto min-w-[260px]",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Title"}),e.jsx("input",{value:r,onChange:t=>N(t.target.value),className:"w-full bg-zinc-900 border border-white/10 rounded px-3 py-2"})]})]}),e.jsxs("aside",{className:"col-span-12 card rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:D}),e.jsx("div",{className:"text-sm opacity-80",children:"Mỗi ảnh = 1 giai đoạn. Chọn ảnh xong thao tác luôn bên dưới."})]}),w.length>0&&e.jsx("div",{className:"mt-3 flex gap-3 overflow-x-auto pb-2",children:w.map(t=>e.jsxs("button",{onClick:()=>k(t.id),className:`p-2 rounded-lg border ${p===t.id?"border-brand-500 bg-white/5":"border-white/10 bg-white/[0.03]"}`,title:t.name,children:[e.jsx("img",{src:t.imageSrc,className:"w-16 h-16 object-cover rounded-md border border-white/10"}),e.jsx("div",{className:"text-[11px] mt-1 max-w-[120px] truncate",children:t.name}),e.jsxs("div",{className:"text-[10px] opacity-70",children:["Steps: ",t.steps.length]})]},t.id))})]}),e.jsxs("section",{className:"col-span-12 grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 lg:col-span-7",children:e.jsx(F,{imageSrc:(l==null?void 0:l.imageSrc)||"",steps:(l==null?void 0:l.steps)||[],onCreateRegion:t=>i(t)})}),e.jsxs("div",{className:"col-span-12 lg:col-span-5",children:[e.jsx(O,{steps:(l==null?void 0:l.steps)||[],onThumbChange:(t,n)=>o(t,{thumbSrc:n}),onTitleChange:(t,n)=>o(t,{title:n}),onDescChange:(t,n)=>o(t,{desc:n}),onMove:v,onDelete:b}),l&&e.jsx("div",{className:"mt-3 text-right",children:e.jsx("button",{onClick:()=>s(l.id),className:"text-xs px-2 py-1 rounded bg-red-600 hover:bg-red-500",children:"Xóa giai đoạn hiện tại"})})]})]})]}),e.jsx(x.Suspense,{fallback:null,children:e.jsx(V,{open:u,onClose:()=>d(!1),title:r,headerUrl:P,stages:w,maxPerPage:j,preset:{width:S.width,height:S.height}})})]})}export{q as default};
