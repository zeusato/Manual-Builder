import{R as j,j as r}from"./index-CAVahwGY.js";import{M as I}from"./MockupFrame-DB1MHdK2.js";function z({shot:e,color:o,tool:n,setTool:t,onUpdate:i,onReset:l}){const m=j.useRef(null),[h,g]=j.useState({w:0,h:0}),p=j.useRef(!1);function M(a){const c=a.currentTarget;let{naturalWidth:s,naturalHeight:d}=c;const f=Math.min(720/s,720/d,1);g({w:Math.round(s*f),h:Math.round(d*f)})}function x(a,c){const s=m.current.getBoundingClientRect(),d=(a-s.left)/s.width,u=(c-s.top)/s.height;return{x:Math.min(Math.max(d,0),1),y:Math.min(Math.max(u,0),1)}}function b(a){var d,u;if(!e)return;(u=(d=a.currentTarget).setPointerCapture)==null||u.call(d,a.pointerId);const c=x(a.clientX,a.clientY),s={id:R(),type:n,color:o,x1:c.x,y1:c.y,x2:c.x,y2:c.y};i({...e,shapes:[...e.shapes,s]}),p.current=!0}function N(a){if(!e||!p.current)return;const c=x(a.clientX,a.clientY),s=e.shapes.slice();s[s.length-1]={...s[s.length-1],x2:c.x,y2:c.y},i({...e,shapes:s})}async function P(a){var s,d;if(!e)return;p.current=!1;try{(d=(s=a.currentTarget).releasePointerCapture)==null||d.call(s,a.pointerId)}catch{}const c=await C(e);i({...e,annotatedSrc:c,shapes:[]})}if(!e)return r.jsx("div",{className:"card rounded-2xl p-6 h-[420px] grid place-items-center text-zinc-400",children:"Upload ảnh để bắt đầu"});const k=e.annotatedSrc||e.src;return r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{className:"card rounded-2xl p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("div",{className:"font-semibold",children:"Preview & Annotate"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("select",{className:"bg-zinc-900 border border-white/10 rounded px-2 py-1",value:n,onChange:a=>t(a.target.value),children:[r.jsx("option",{value:"rect",children:"Rectangle"}),r.jsx("option",{value:"circle",children:"Circle"}),r.jsx("option",{value:"line",children:"Line"}),r.jsx("option",{value:"arrow",children:"Arrow"})]}),r.jsx("input",{type:"color",value:o,readOnly:!0,className:"w-10 h-8 rounded"}),r.jsx("button",{onClick:l,className:"px-3 py-1 rounded bg-zinc-800 hover:bg-zinc-700",children:"Reset"})]})]}),r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsxs("div",{className:"relative border border-white/10 rounded-xl overflow-hidden",style:{width:h.w||720,height:h.h||720},children:[r.jsx("img",{ref:m,src:k,onLoad:M,className:"block",style:{width:h.w||720,height:h.h||720}}),r.jsxs("svg",{className:"absolute inset-0",width:h.w||720,height:h.h||720,onPointerDown:b,onPointerMove:N,onPointerUp:P,onPointerLeave:P,children:[r.jsx("defs",{children:r.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"10",refY:"3.5",orient:"auto",children:r.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:o})})}),e.shapes.map(a=>{const c=a.x1*(h.w||720),s=a.y1*(h.h||720),d=a.x2*(h.w||720),u=a.y2*(h.h||720),w={stroke:a.color,fill:"none",strokeWidth:3};if(a.type==="rect"){const f=Math.min(c,d),v=Math.min(s,u),y=Math.abs(d-c),T=Math.abs(u-s);return r.jsx("rect",{x:f,y:v,width:y,height:T,rx:8,ry:8,...w},a.id)}else if(a.type==="circle"){const f=(c+d)/2,v=(s+u)/2,y=Math.max(Math.abs(d-c),Math.abs(u-s))/2;return r.jsx("circle",{cx:f,cy:v,r:y,...w},a.id)}else return a.type==="line"?r.jsx("line",{x1:c,y1:s,x2:d,y2:u,...w},a.id):r.jsx("line",{x1:c,y1:s,x2:d,y2:u,...w,markerEnd:"url(#arrowhead)"},a.id)})]})]}),r.jsxs("div",{className:"hidden xl:block",children:[r.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Mockup preview"}),r.jsx("div",{className:"p-3 rounded-xl bg-white/5",children:r.jsx(I,{screenUrl:k,width:260})})]})]})]})})}function R(){return Math.random().toString(36).slice(2)}async function C(e){const o=await S(e.annotatedSrc||e.src),n=document.createElement("canvas");n.width=o.naturalWidth,n.height=o.naturalHeight;const t=n.getContext("2d");t.drawImage(o,0,0,n.width,n.height);for(const i of e.shapes){const l=i.x1*n.width,m=i.y1*n.height,h=i.x2*n.width,g=i.y2*n.height;if(t.strokeStyle=i.color,t.fillStyle=i.color,t.lineWidth=Math.max(3,Math.min(n.width,n.height)*.004),i.type==="rect"){const p=Math.min(l,h),M=Math.min(m,g),x=Math.abs(h-l),b=Math.abs(g-m);W(t,p,M,x,b,Math.min(x,b)*.08),t.stroke()}else if(i.type==="circle"){const p=(l+h)/2,M=(m+g)/2,x=Math.max(Math.abs(h-l),Math.abs(g-m))/2;t.beginPath(),t.arc(p,M,x,0,Math.PI*2),t.stroke()}else i.type==="line"?(t.beginPath(),t.moveTo(l,m),t.lineTo(h,g),t.stroke()):i.type==="arrow"&&A(t,l,m,h,g)}return n.toDataURL("image/png")}function S(e){return new Promise((o,n)=>{const t=new Image;t.crossOrigin="anonymous",t.onload=()=>o(t),t.onerror=n,t.src=e})}function W(e,o,n,t,i,l){e.beginPath(),e.moveTo(o+l,n),e.arcTo(o+t,n,o+t,n+i,l),e.arcTo(o+t,n+i,o,n+i,l),e.arcTo(o,n+i,o,n,l),e.arcTo(o,n,o+t,n,l),e.closePath()}function A(e,o,n,t,i){e.beginPath(),e.moveTo(o,n),e.lineTo(t,i),e.stroke();const l=Math.max(10,Math.hypot(t-o,i-n)*.04),m=Math.atan2(i-n,t-o);e.beginPath(),e.moveTo(t,i),e.lineTo(t-l*Math.cos(m-Math.PI/6),i-l*Math.sin(m-Math.PI/6)),e.lineTo(t-l*Math.cos(m+Math.PI/6),i-l*Math.sin(m+Math.PI/6)),e.closePath(),e.fill()}export{z as default};
