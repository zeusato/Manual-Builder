const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-B3C7UIgp.js","assets/index-9AhgM91U.js","assets/index-BAzET-b6.css"])))=>i.map(i=>d[i]);
import{R as f,j as e,_ as w}from"./index-9AhgM91U.js";import{s as S}from"./Silk-BXyBIzFR.js";const y="#f43f5e";function O({open:i,onClose:l,title:r,headerUrl:d,stages:h,maxPerPage:b,preset:a}){const c=f.useRef(null),[m,j]=f.useState(1),[p,R]=f.useState(!0),v=f.useCallback(()=>{const t=c.current;if(!t)return;const n=getComputedStyle(t),s=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight),o=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom),x=t.clientWidth-s,u=t.clientHeight-o,g=Math.min(x/a.width,u/a.height,1);j(g>0&&isFinite(g)?g:1)},[a.width,a.height]);if(f.useLayoutEffect(()=>{if(!i)return;v();const t=new ResizeObserver(v),n=c.current;n&&t.observe(n);const s=()=>v();return window.addEventListener("resize",s),()=>{t.disconnect(),window.removeEventListener("resize",s)}},[i,v]),!i)return null;const N=A(h,b);async function _(){const t=Array.from(c.current.querySelectorAll("[data-page]"));let n=1;if(p)for(const s of t){const o=await k(s,a,{pixelRatio:1.25,maxBytes:1e6});P(o,`manual-web-${n}.jpg`),n++}else{const{toPng:s}=await w(async()=>{const{toPng:o}=await import("./index-xVp0PEHv.js");return{toPng:o}},[]);for(const o of t){const x=await s(o,{pixelRatio:2,canvasWidth:a.width,canvasHeight:a.height,style:{transform:"none"}});P(x,`manual-web-${n}.png`),n++}}}async function E(){const{default:t}=await w(async()=>{const{default:o}=await import("./jspdf.es.min-B3C7UIgp.js").then(x=>x.j);return{default:o}},__vite__mapDeps([0,1,2])),n=Array.from(c.current.querySelectorAll("[data-page]")),s=new t({orientation:"landscape",unit:"px",format:[a.width,a.height]});for(let o=0;o<n.length;o++){const x=n[o];if(o>0&&s.addPage([a.width,a.height],"l"),p){const u=await k(x,a,{pixelRatio:1.25,maxBytes:1e6});s.addImage(u,"JPEG",0,0,a.width,a.height)}else{const{toPng:u}=await w(async()=>{const{toPng:W}=await import("./index-xVp0PEHv.js");return{toPng:W}},[]),g=await u(x,{pixelRatio:2,canvasWidth:a.width,canvasHeight:a.height,style:{transform:"none"}});s.addImage(g,"PNG",0,0,a.width,a.height)}}s.save("manual-web.pdf")}return e.jsx("div",{className:"fixed inset-0 z-50 modal-backdrop p-6",children:e.jsxs("div",{className:"mx-auto h-[90%] max-w-[95%] bg-zinc-900 rounded-2xl border border-white/10 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/10 flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold",children:"WEB Pages Preview"}),e.jsxs("label",{className:"ml-4 flex items-center gap-2 text-sm opacity-90",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:t=>R(t.target.checked)}),"Giảm dung lượng tối đa"]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsxs("button",{onClick:_,className:"px-3 py-1 rounded bg-brand-600 hover:bg-brand-500",children:["Export ",p?"JPEG (≤1MB/trang)":"PNG"]}),e.jsx("button",{onClick:E,className:"px-3 py-1 rounded bg-zinc-800 hover:bg-zinc-700",children:"Export PDF"}),e.jsx("button",{onClick:l,className:"px-3 py-1 rounded bg-zinc-700 hover:bg-zinc-600",children:"Close"})]})]}),e.jsx("div",{ref:c,className:"flex-1 overflow-auto p-4",children:e.jsx("div",{className:"space-y-8",children:N.map((t,n)=>e.jsx("div",{className:"mx-auto",style:{width:a.width*m,height:a.height*m},children:e.jsxs("div",{"data-page":!0,style:{transform:`scale(${m})`,transformOrigin:"top left",width:a.width,height:a.height,background:"white",color:"black",borderRadius:16,overflow:"hidden",position:"relative"},className:"border border-black/10",children:[e.jsx(C,{headerUrl:d,title:r}),e.jsxs("div",{className:"px-6 py-4 grid grid-cols-12 gap-12",style:{height:a.height-220},children:[e.jsx("div",{className:"col-span-7 relative",children:e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:`0 0 ${t.stage.natW||1e3} ${t.stage.natH||1e3}`,preserveAspectRatio:"xMidYMid meet",children:[e.jsx("image",{href:t.stage.imageSrc,x:"0",y:"0",width:t.stage.natW||1e3,height:t.stage.natH||1e3,preserveAspectRatio:"xMidYMid meet"}),t.steps.map(s=>e.jsxs("g",{children:[e.jsx("rect",{x:s.region.xPct*(t.stage.natW||1),y:s.region.yPct*(t.stage.natH||1),width:s.region.wPct*(t.stage.natW||1),height:s.region.hPct*(t.stage.natH||1),rx:12,ry:12,fill:"none",stroke:y,strokeWidth:8}),e.jsxs("g",{transform:`translate(${s.region.xPct*(t.stage.natW||1)}, ${s.region.yPct*(t.stage.natH||1)})`,children:[e.jsx("circle",{r:20,cx:20,cy:20,fill:"white",stroke:y,strokeWidth:8}),e.jsx("text",{x:20,y:27,fontSize:20,textAnchor:"middle",fontWeight:800,fill:y,children:s.index})]})]},s.id))]})}),e.jsx("div",{className:"col-span-5",children:e.jsx("div",{className:"h-full flex flex-col justify-center gap-12",children:t.steps.map(s=>e.jsx(F,{st:s},s.id))})})]}),e.jsx("img",{src:S,"aria-hidden":!0,className:"absolute -right-20 -bottom-40 w-[720px] opacity-30 pointer-events-none"}),e.jsx(L,{pageNo:n+1,total:N.length})]})},n))})})]})})}function F({st:i}){return e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`${i.thumbSrc?"border border-black/10 bg-black/5":"invisible"} w-32 h-32 rounded-lg overflow-hidden`,children:i.thumbSrc&&e.jsx("img",{src:i.thumbSrc,className:"w-full h-full",style:{objectFit:"contain"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"mt-5 text-4xl text-[#FF6500] font-bold",children:i.title||`Bước ${i.index}`}),e.jsx("div",{className:"text-2xl leading-relaxed text-black/85 whitespace-pre-wrap",children:i.desc||""})]})]})}function C({headerUrl:i,title:l}){return e.jsxs("div",{className:"relative h-[180px] w-full",children:[e.jsx("img",{src:i,className:"absolute inset-0 w-full h-full object-fill"}),e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"text-[#002865] px-6 text-left ml-60 my-auto text-5xl font-extrabold leading-tight drop-shadow",children:l})})]})}function L({pageNo:i,total:l}){return e.jsxs("div",{className:"h-[50px] w-full grid place-items-center text-base text-black/80",children:["Trang ",i,"/",l]})}function A(i,l){const r=[];for(const d of i){for(let h=0;h<d.steps.length;h+=l)r.push({stage:d,steps:d.steps.slice(h,h+l)});d.steps.length===0&&r.push({stage:d,steps:[]})}return r}function P(i,l){const r=document.createElement("a");r.href=i,r.download=l,document.body.appendChild(r),r.click(),r.remove()}function D(i){const l=i.split(",")[1]||"";return Math.floor(l.length*3/4)-(l.endsWith("==")?2:l.endsWith("=")?1:0)}async function k(i,l,r){const{pixelRatio:d,maxBytes:h}=r,{toCanvas:b}=await w(async()=>{const{toCanvas:j}=await import("./index-xVp0PEHv.js");return{toCanvas:j}},[]),a=await b(i,{pixelRatio:d,canvasWidth:l.width,canvasHeight:l.height,style:{transform:"none"}});let c=.72,m=a.toDataURL("image/jpeg",c);for(;D(m)>h&&c>.5;)c-=.05,m=a.toDataURL("image/jpeg",c);return m}export{O as default};
