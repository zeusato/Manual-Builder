const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-DLKAkQ-f.js","assets/index-DMIoXnDW.js","assets/index-DGJeUUzy.css"])))=>i.map(i=>d[i]);
import{R as b,j as e,_ as N}from"./index-DMIoXnDW.js";import{M as D}from"./MockupFrame-CB_TNA__.js";const F="/Manual-Builder/assets/Silk-CV7r9GD2.png",y={sizeRatio:.42,right:-80,bottom:-180,opacity:.3,rotateDeg:0};function S(n,s){const l=[];for(let d=0;d<n.length;d+=s)l.push(n.slice(d,d+s));return l}function z(n){const s=n.split(",")[1]||"";return Math.floor(s.length*3/4)-(s.endsWith("==")?2:s.endsWith("=")?1:0)}async function _(n,s,l){const{pixelRatio:d,maxBytes:o,aggressive:t}=l,{toCanvas:f}=await N(async()=>{const{toCanvas:w}=await import("./index-xVp0PEHv.js");return{toCanvas:w}},[]),g=t?Math.min(d,1.25):d,x=await f(n,{pixelRatio:g,canvasWidth:s.width,canvasHeight:s.height,style:{transform:"none"}});let h=t?.72:.92,m=x.toDataURL("image/jpeg",h);for(;z(m)>o&&h>.5;)h-=.05,m=x.toDataURL("image/jpeg",h);return m}function B({open:n,onClose:s,title:l,headerUrl:d,shots:o,preset:t,pixelRatio:f}){const g=b.useRef(null),[x,h]=b.useState(1),[m,w]=b.useState(!0),j=b.useCallback(()=>{const i=g.current;if(!i)return;const a=getComputedStyle(i),r=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight),c=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom),u=i.clientWidth-r,v=i.clientHeight-c,p=Math.min(u/t.width,v/t.height,1);h(p>0&&isFinite(p)?p:1)},[t]);if(b.useLayoutEffect(()=>{if(!n)return;j();const i=new ResizeObserver(j),a=g.current;a&&i.observe(a);const r=()=>j();return window.addEventListener("resize",r),()=>{i.disconnect(),window.removeEventListener("resize",r)}},[n,j]),!n)return null;const C=t.maxCols*t.maxRows,P=S(o,C);async function E(){const i=Array.from(g.current.querySelectorAll("[data-page]"));let a=1;if(m)for(const r of i){const c=await _(r,t,{pixelRatio:f,maxBytes:1e6,aggressive:!0});k(c,`manual-page-${a}.jpg`),a++}else{const{toPng:r}=await N(async()=>{const{toPng:c}=await import("./index-xVp0PEHv.js");return{toPng:c}},[]);for(const c of i){const u=await r(c,{pixelRatio:f,canvasWidth:t.width,canvasHeight:t.height,style:{transform:"none"}});k(u,`manual-page-${a}.png`),a++}}}async function R(){const{default:i}=await N(async()=>{const{default:c}=await import("./jspdf.es.min-DLKAkQ-f.js").then(u=>u.j);return{default:c}},__vite__mapDeps([0,1,2])),a=Array.from(g.current.querySelectorAll("[data-page]")),r=new i({orientation:t.width>=t.height?"landscape":"portrait",unit:"px",format:[t.width,t.height]});for(let c=0;c<a.length;c++){const u=a[c];if(c>0&&r.addPage([t.width,t.height],t.width>=t.height?"l":"p"),m){const v=await _(u,t,{pixelRatio:f,maxBytes:1e6,aggressive:!0});r.addImage(v,"JPEG",0,0,t.width,t.height)}else{const{toPng:v}=await N(async()=>{const{toPng:M}=await import("./index-xVp0PEHv.js");return{toPng:M}},[]),p=await v(u,{pixelRatio:f,canvasWidth:t.width,canvasHeight:t.height,style:{transform:"none"}});r.addImage(p,"PNG",0,0,t.width,t.height)}}r.save("manual.pdf")}return e.jsx("div",{className:"fixed inset-0 z-50 modal-backdrop p-6",children:e.jsxs("div",{className:"mx-auto h-[90%] max-w-[95%] bg-zinc-900 rounded-2xl border border-white/10 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/10 flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold",children:"Pages Preview"}),e.jsxs("label",{className:"ml-4 flex items-center gap-2 text-sm opacity-90",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:i=>w(i.target.checked)}),"Giảm dung lượng tối đa"]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsxs("button",{onClick:E,className:"px-3 py-1 rounded bg-brand-600 hover:bg-brand-500",children:["Export ",m?"JPEG (≤1MB/trang)":"PNG"]}),e.jsx("button",{onClick:R,className:"px-3 py-1 rounded bg-zinc-800 hover:bg-zinc-700",children:"Export PDF"}),e.jsx("button",{onClick:s,className:"px-3 py-1 rounded bg-zinc-700 hover:bg-zinc-600",children:"Close"})]})]}),e.jsx("div",{ref:g,className:"flex-1 overflow-auto p-4",children:e.jsx("div",{className:"space-y-8",children:P.map((i,a)=>e.jsx("div",{className:"mx-auto",style:{width:t.width*x,height:t.height*x},children:e.jsx("div",{style:{transform:`scale(${x})`,transformOrigin:"top left",width:t.width,height:t.height},children:e.jsx(L,{index:a,headerUrl:d,title:l,items:i,preset:t,total:P.length})})},a))})})]})})}function L({index:n,headerUrl:s,title:l,items:d,preset:o,total:t}){const g={display:"grid",gridTemplateColumns:`repeat(${Math.min(o.maxCols,Math.max(1,Math.min(o.maxCols,d.length)))}, 1fr)`,gap:16,alignContent:"center",justifyItems:"center",alignItems:"start",height:o.height-260},x={width:o.width,height:o.height,background:"white",color:"black",borderRadius:16,overflow:"hidden",position:"relative"};return e.jsxs("div",{"data-page":!0,className:"mx-auto border border-black/10 rounded-xl overflow-hidden",style:x,children:[e.jsx("img",{src:F,"aria-hidden":!0,className:"pointer-events-none select-none",style:{position:"absolute",right:y.right,bottom:y.bottom,width:`${Math.floor(o.width*y.sizeRatio)}px`,height:"auto",opacity:y.opacity,transform:`rotate(${y.rotateDeg}deg)`,zIndex:0}}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative h-[180px] w-full",children:[e.jsx("img",{src:s,className:"absolute inset-0 w-full h-full object-fill"}),e.jsx("div",{className:"absolute inset-0"}),e.jsx("div",{className:"absolute inset-0 flex items-cente",children:e.jsx("div",{className:"text-[#002865] px-6 text-left ml-60 my-auto text-5xl font-extrabold leading-tight drop-shadow",children:l})})]}),e.jsx("div",{className:"px-6 py-4",style:{height:o.height-260},children:e.jsx("div",{style:g,children:d.map((h,m)=>{const w=h.annotatedSrc||h.src;return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{filter:"drop-shadow(12px 16px 12px rgba(0,0,0,0.34)) drop-shadow(3px 4px 4px rgba(0,0,0,0.22))"},children:e.jsx(D,{screenUrl:w,width:Math.min(280,Math.floor((o.width-80)/o.maxCols)-24)})}),e.jsxs("div",{className:"mt-5 text-4xl text-[#FF6500] font-bold",children:["Bước ",n*o.maxCols*o.maxRows+m+1,":"]}),e.jsx("div",{className:"text-2xl leading-relaxed text-black/85 max-w-[340px] mx-auto",children:h.description||""})]},h.id)})})}),e.jsxs("div",{className:"h-[60px] w-full grid place-items-center text-xl text-black/80",children:["Trang ",n+1,"/",t]})]})]})}function k(n,s){const l=document.createElement("a");l.href=n,l.download=s,document.body.appendChild(l),l.click(),l.remove()}export{B as default};
